<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>20' FCL Container Calculator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    .blink {
      animation: blink 1s infinite;
    }
  </style>
</head>
<body className="bg-gray-100 min-h-screen flex items-center justify-center">
  <div id="root"></div>
  <script type="text/babel">
    // Defining the product data
    const products = [
      { name: "BORAX DECAHYDRATE - GRANULAR", weight: 25, mtPerFCL: 21 },
      { name: "BORAX DECAHYDRATE - GRANULAR", weight: 1000, mtPerFCL: 20 },
      { name: "BORAX DECAHYDRATE - POWDER", weight: 25, mtPerFCL: 21 },
      { name: "BORAX DECAHYDRATE - POWDER", weight: 1000, mtPerFCL: 20 },
      { name: "BORIC ACID - GRANULAR", weight: 25, mtPerFCL: 21 },
      { name: "BORIC ACID - GRANULAR", weight: 1000, mtPerFCL: 20 },
      { name: "BORIC ACID - GRANULAR", weight: 1050, mtPerFCL: 21 },
      { name: "BORIC ACID - GRANULAR", weight: 1200, mtPerFCL: 24 },
      { name: "BORIC ACID - POWDER", weight: 25, mtPerFCL: 21 },
      { name: "BORIC ACID - POWDER", weight: 1000, mtPerFCL: 20 },
      { name: "BORON OXIDE (GLASSY)", weight: 25, mtPerFCL: 21 },
      { name: "BORON OXIDE (GLASSY)", weight: 1000, mtPerFCL: 20 },
      { name: "BORON OXIDE (POROUS)", weight: 25, mtPerFCL: 21 },
      { name: "BORON OXIDE (POROUS)", weight: 500, mtPerFCL: 20 },
      { name: "ETIBOR-48 BORAX PENTAHYDRATE - GRANULAR", weight: 25, mtPerFCL: 24 },
      { name: "ETIBOR-48 BORAX PENTAHYDRATE - GRANULAR", weight: 1000, mtPerFCL: 20 },
      { name: "ETIBOR-48 BORAX PENTAHYDRATE - GRANULAR", weight: 1200, mtPerFCL: 24 },
      { name: "ETIBOR-48 BORAX PENTAHYDRATE - POWDER", weight: 1000, mtPerFCL: 20 },
      { name: "ETIBOR-68 ANHYDROUS BORAX - GRANULAR", weight: 25, mtPerFCL: 24 },
      { name: "ETIBOR-68 ANHYDROUS BORAX - GRANULAR", weight: 1000, mtPerFCL: 20 },
      { name: "ETIBOR-68 ANHYDROUS BORAX - GRANULAR", weight: 1200, mtPerFCL: 24 },
      { name: "ETIBOR-68 ANHYDROUS BORAX - POWDER", weight: 1000, mtPerFCL: 20 },
      { name: "ETIBOR-68 ANHYDROUS BORAX - POWDER", weight: 1200, mtPerFCL: 24 },
      { name: "ETICOL-43", weight: 1000, mtPerFCL: 20 },
      { name: "ETICOL-43", weight: 1050, mtPerFCL: 21 },
      { name: "ETICOL-43", weight: 1200, mtPerFCL: 24 },
      { name: "ETICOL-CERAMIC", weight: 1200, mtPerFCL: 24 },
      { name: "ETIDOT-67", weight: 20, mtPerFCL: 14.4 },
      { name: "ETIDOT-67", weight: 600, mtPerFCL: 12 },
      { name: "ETIDOT-67", weight: 900, mtPerFCL: 18 },
      { name: "ETIFERT-B11", weight: 25, mtPerFCL: 21 },
      { name: "ETIFERT-B15", weight: 25, mtPerFCL: 24 },
      { name: "ETIFERT-B17", weight: 25, mtPerFCL: 21 },
      { name: "ETIFERT-B20", weight: 20, mtPerFCL: 14.4 },
      { name: "ETI-KBOR", weight: 25, mtPerFCL: 21 },
      { name: "GROUND COLEMANITE", weight: 1000, mtPerFCL: 20 },
      { name: "GROUND COLEMANITE", weight: 1200, mtPerFCL: 24 },
      { name: "GROUND COLEMANITE", weight: 2100, mtPerFCL: 21 },
      { name: "ULEXITE", weight: 1000, mtPerFCL: 20 },
      { name: "ZINC BORATE", weight: 800, mtPerFCL: 16 },
      { name: "ZINC BORATE", weight: 1000, mtPerFCL: 20 }
    ];

    // Function to format numbers with commas and fixed decimals
    const formatNumber = (num, decimals = 0) => {
      return Number(num).toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };

    // Check if a number is a multiple of another, avoiding floating-point precision issues
    const isMultiple = (value, multiple) => {
      // Scale by 1000 to convert decimals to integers (e.g., 14.4 -> 14400)
      const scale = 1000;
      const scaledValue = Math.round(value * scale);
      const scaledMultiple = Math.round(multiple * scale);
      return scaledValue % scaledMultiple === 0;
    };

    // Creating the main React component
    const ContainerCalculator = () => {
      const [product, setProduct] = React.useState('');
      const [weight, setWeight] = React.useState('');
      const [amount, setAmount] = React.useState('');
      const [result, setResult] = React.useState(null);

      // Getting unique product names for the first dropdown
      const uniqueProducts = [...new Set(products.map(p => p.name))];

      // Getting available weights for the selected product
      const availableWeights = products
        .filter(p => p.name === product)
        .map(p => p.weight);

      // Handling product selection
      const handleProductChange = (e) => {
        setProduct(e.target.value);
        setWeight('');
        setResult(null);
      };

      // Handling weight selection
      const handleWeightChange = (e) => {
        setWeight(e.target.value);
        setResult(null);
      };

      // Handling amount input
      const handleAmountChange = (e) => {
        const value = e.target.value;
        // Allow only valid numbers with up to 5 decimal places
        if (value === "" || /^\d*\.?\d{0,5}$/.test(value)) {
          setAmount(value);
          setResult(null);
        }
      };

      // Reset all inputs and results
      const handleReset = () => {
        setProduct('');
        setWeight('');
        setAmount('');
        setResult(null);
      };

      // Calculating containers needed
      const calculateContainers = (e) => {
        e.preventDefault();

        // Validate inputs
        if (!product) {
          setResult("Please select a product.");
          return;
        }
        if (!weight) {
          setResult("Please select a packaging weight.");
          return;
        }
        if (!amount) {
          setResult("Please enter a PO volume.");
          return;
        }

        const selectedProduct = products.find(
          p => p.name === product && p.weight === parseInt(weight)
        );
        if (!selectedProduct) {
          setResult("Invalid product or weight selection.");
          return;
        }

        const amountMt = parseFloat(amount);
        if (isNaN(amountMt) || amountMt <= 0) {
          setResult("PO volume must be a positive number.");
          return;
        }
        if (amountMt > 1000000) {
          setResult("PO volume is too large. Please enter a value up to 1,000,000 MT.");
          return;
        }

        const mtPerFCL = selectedProduct.mtPerFCL;
        // Format numbers once for efficiency
        const formattedAmount = formatNumber(amountMt, amountMt % 1 === 0 ? 0 : 5);
        const formattedWeight = formatNumber(weight);
        const formattedMtPerFCL = formatNumber(mtPerFCL, mtPerFCL % 1 === 0 ? 0 : 5);

        // Check if amount is a multiple of mt riparian point
        if (!isMultiple(amountMt, mtPerFCL)) {
          setResult({
            message: `The PO volume must be in multiples of ${formattedMtPerFCL} MT, kindly revise your PO volume.`,
            reference: {
              product,
              weight,
              mtPerFCL
            }
          });
          return;
        }

        // Calculate exact containers since amount is a multiple
        const containers = amountMt / mtPerFCL;
        const formattedContainers = formatNumber(containers, 0);

        setResult({
          message: `You will need <span class="font-bold text-blue-600">${formattedContainers}</span> x 20' FCL container(s) for ${formattedAmount} MT of ${product} (Weight: ${formattedWeight} kg).`,
          reference: null
        });
      };

      // Rendering the container
      return (
        <div className="max-w-md mx-auto bg-white p-6 rounded-md shadow-lg">
          <div className="flex justify-center mb-6">
            <img src="https://i.ibb.co/7b8f3c2/ktmln-logo.jpg" alt="KTMLN Logo" className="h-16" />
          </div>
          <h1 className="text-2xl font-bold mb-6 text-center">20' FCL Container Calculator</h1>
          
          {/* Product selection dropdown */}
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Product Name</label>
            <select
              value={product}
              onChange={handleProductChange}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Select Product Name</option>
              {uniqueProducts.map((name, index) => (
                <option key={index} value={name}>{name}</option>
              ))}
            </select>
          </div>

          {/* Weight selection dropdown */}
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Packaging Weight (kg)</label>
            <select
              value={weight}
              onChange={handleWeightChange}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              disabled={!product}
            >
              <option value="">Select Weight</option>
              {availableWeights.map((w, index) => (
                <option key={index} value={pw}>{formatNumber(pw)}</option>
              ))}
            </select>
          </div>

          {/* PO Volume input */}
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">PO Volume (MT)</label>
            <input
              type="number"
              value={amount}
              onChange={handleAmountChange}
              className="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Enter PO volume in MT"
              min="0"
              step="0.001"
            />
          </div>

          {/* Buttons */}
          <div className="flex space-x-4">
            <button
              onClick={calculateContainers}
              className="flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600"
            >
              Calculate
            </button>
            <button
              onClick={handleReset}
              className="flex-1 bg-gray-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-600"
            >
              Reset
            </button>
          </div>

          {/* Result display */}
          {result && (
            <div className="mt-6 p-4 bg-gray-100 rounded-md">
              <p className={`text-center text-sm ${result.reference ? 'font-bold text-red-600 blink' : 'text-gray-600'}`} dangerouslySetInnerHTML={{ __html: result.message }}></p>
              {result.reference && (
                <div className="mt-2 text-xs text-gray-600">
                  <p><strong>Reference:</strong></p>
                  <p>Product: {result.reference.product}</p>
                  <p>Weight: {formatNumber(result.reference.weight)} kg</p>
                  <p>MT per FCL: {formatNumber(result.reference.mtPerFCL, result.reference.mtPerFCL % 1 === 0 ? 0 : 5)} MT</p>
                </div>
              )}
            </div>
          )}
        </div>
      );
    };

    // Rendering the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ContainerCalculator />);
  </script>
</body>
</html>
